<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Termtrainer ‚Äì Multiplikation mit Levelsystem</title>
<style>
  html, body {
    height: 100%;
    overflow-x: hidden;
  }
  body {
    font-family: system-ui, Arial, sans-serif;
    background: linear-gradient(to bottom right,#f0f4ff,#e0f7fa);
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 { color:#333; margin:10px 0; font-size:1.8em; }
  #task { font-size:1.6em; margin:15px auto; white-space:pre-line; }
  #result { font-size:1.2em; margin:10px; font-weight:bold; }
  #score { font-size:1.1em; margin:8px; color:#333; }
  #levelDisplay { font-weight:bold; color:#007bff; margin-bottom:5px; }

  /* Fortschrittsbalken */
  #progressContainer {
    width:80%; max-width:400px; height:20px;
    background-color:#ddd; border-radius:10px;
    margin:10px auto 20px; overflow:hidden;
  }
  #progressBar {
    height:100%; width:0%; background-color:#4caf50;
    transition:width 0.3s ease;
  }

  input {
    padding:10px; font-size:1.2em;
    width:80%; max-width:300px;
    text-align:center;
    border-radius:8px; border:1px solid #aaa;
  }
  input:focus { outline:none; border-color:#007bff; }
  button {
    background:#007bff; color:white; border:none;
    padding:10px 18px; margin:6px; font-size:1em;
    border-radius:8px; cursor:pointer;
  }
  button:hover { background:#0056b3; }

  .shortcutButtons { margin-top:8px; }
  .shortcutButtons button {
    background:#e3e3e3; color:#000;
    border:1px solid #bbb; padding:6px 10px;
    font-size:1.1em;
  }
  .shortcutButtons button:hover { background:#ccc; }
  @media (min-width:700px){.shortcutButtons{display:none;}}
  @media (max-width:700px){
    .shortcutButtons button{padding:8px 14px;font-size:1.3em;}
  }

  details summary {
    cursor:pointer; color:#007bff;
    margin-top:8px; user-select:none;
  }
  details summary:hover { text-decoration:underline; }
</style>
</head>
<body>
<h1>Termtrainer ‚Äì Multiplikation</h1>
<div id="levelDisplay">Level 1: Ganze Zahlen</div>
<div id="score">Lade...</div>
<div id="progressContainer"><div id="progressBar"></div></div>

<div id="task">...</div>

<input type="text" id="answer" placeholder="Deine L√∂sung" autocomplete="off" spellcheck="false"><br>
<div class="shortcutButtons">
  <button type="button" onclick="insertSymbol('¬≤')">¬≤</button>
  <button type="button" onclick="insertSymbol('¬≥')">¬≥</button>
</div>
<button id="checkBtn">Pr√ºfen</button>
<button id="newBtn">Neue Aufgabe</button>
<p id="result"></p>

<p style="font-size:0.8em;color:#555;margin-top:40px;">
Diese Seite speichert keine pers√∂nlichen Daten und l√§uft vollst√§ndig lokal im Browser.<br>
¬© 2025 Termtrainer mit Levelsystem
</p>

<script>
document.addEventListener("DOMContentLoaded",()=>{

  const answerEl=document.getElementById("answer");
  const checkBtn=document.getElementById("checkBtn");
  const newBtn=document.getElementById("newBtn");
  const taskEl=document.getElementById("task");
  const resultEl=document.getElementById("result");
  const scoreEl=document.getElementById("score");
  const levelDisplay=document.getElementById("levelDisplay");
  const progressBar=document.getElementById("progressBar");

  let lastFocusedInput=answerEl;
  answerEl.addEventListener("focus",()=>{lastFocusedInput=answerEl;});

  window.insertSymbol=function(symbol){
    const target=lastFocusedInput||answerEl;
    target.focus();
    const start=target.selectionStart??target.value.length;
    const end=target.selectionEnd??target.value.length;
    target.value=target.value.slice(0,start)+symbol+target.value.slice(end);
    const pos=start+symbol.length;
    requestAnimationFrame(()=>{target.selectionStart=target.selectionEnd=pos;});
  };

  // Zufallsfunktionen
  const COEFFS=[2,3,4,5,6,7,8,9];
  const VARS=['a','b','m','n','p','q','x','y'];
  const randomChoice=a=>a[Math.floor(Math.random()*a.length)];
  const randomSign=()=>Math.random()<0.5?'-':'+';
  const randomCoeff=()=>randomChoice(COEFFS);
  const randomVar=()=>randomChoice(VARS);
  const sortVars=(v1,v2)=>[v1,v2].sort().join('');
  const formatCoeff=(n,isVar)=>{if(!isVar)return String(n);if(n===1)return"";if(n===-1)return"-";return String(n);};
  const normMul=s=>s.replace(/\s+/g,'').replace(/^(\+)?/,'').replace(/¬≤/g,'^2').replace(/¬≥/g,'^3').replace(/‚àí/g,'-').toLowerCase();

  // Spielvariablen
  let level=1;
  let correctSolution="";
  let round=1,score=0,totalRounds=10;
  let firstTry=true;

  const LEVEL_NAMES=[
    "Level 1: Ganze Zahlen",
    "Level 2: Monome",
    "Level 3: Monom ¬∑ Binom",
    "Level 4: Binom ¬∑ Binom",
    "Level 5: Gemischt"
  ];

  // --- Aufgabenfunktionen ---
  // Level 1: Ganze Zahlen (2‚Äì3 Faktoren)
  function createIntTask(){
    const count = Math.random()<0.5?2:3;
    let nums=[], res=1, txt="";
    for(let i=0;i<count;i++){
      const n=Math.floor(Math.random()*11)-5||1;
      nums.push(n); res*=n;
    }
    txt=nums.map(n=>`(${n})`).join(" ¬∑ ");
    correctSolution=String(res);
    return `${txt} = ?`;
  }

  // Level 2: Monome (2‚Äì3 Faktoren)
  function createSimpleTask(){
    const count=Math.random()<0.5?2:3;
    let coeff=1,vars=[],sign=1,text="";
    for(let i=0;i<count;i++){
      const s=randomSign()==='-'?-1:1;
      const n=randomCoeff();
      const v=randomVar();
      coeff*=s*n;
      vars.push(v);
      text += `(${s===-1?'-':''}${n}${v}) ¬∑ `;
    }
    text=text.slice(0,-3);
    vars.sort();
    const varCount={};
    for(const v of vars)varCount[v]=(varCount[v]||0)+1;
    let varsPart="";
    for(const [v,exp] of Object.entries(varCount)){
      varsPart+=v+(exp>1?(exp===2?'¬≤':'¬≥'):'');
    }
    correctSolution=`${formatCoeff(coeff,true)}${varsPart}`;
    return `${text} = ?`;
  }

  // Level 3: Monom ¬∑ Binom (abwechslungsreicher, max Hoch ¬≥)
  function createMonomBinom(){
    const coeff=randomCoeff()*(Math.random()<0.5?-1:1);
    const v1=randomVar();
    const exp1=Math.floor(Math.random()*3)+1;
    const monom=`${formatCoeff(coeff,true)}${v1}${exp1>1?(exp1===2?'¬≤':'¬≥'):''}`;
    const v2=randomVar();
    const b1=randomCoeff()*(Math.random()<0.5?-1:1);
    const b2=randomCoeff()*(Math.random()<0.5?-1:1);
    const binom=`(${b1>=0?'+':''}${b1}${v2} ${b2>=0?'+':'-'} ${Math.abs(b2)})`;

    // L√∂sung: Monom verteilen
    const term1=`${coeff*b1}${v1}${exp1>0?(exp1===1?'':exp1===2?'¬≤':'¬≥'):''}${v2}`;
    const term2=`${coeff*b2}${v1}${exp1>0?(exp1===1?'':exp1===2?'¬≤':'¬≥'):''}`;
    correctSolution=`${term1.startsWith('-')?'':'+'}${term1} ${term2.startsWith('-')?'':'+'} ${term2}`.replace(/\+\s*-/g,'- ').replace(/^\+\s*/,'');
    return `${monom} ¬∑ ${binom} = ?`;
  }

  function createGeneralBinom(){
    let v1=randomVar(),v2=randomVar();
    if(Math.random()<0.5)v2=v1;
    const a1=randomCoeff(),a2=randomCoeff(),b=randomCoeff(),c=randomCoeff();
    const s1=randomSign(),s2=randomSign();
    const sb=s1==='+'?1:-1,sc=s2==='+'?1:-1;
    const sameVar=v1===v2;
    let sol="";
    if(sameVar){
      const a2v2=a1*a2;
      const xCoeff=(a1*sc*c)+(a2*sb*b);
      const bc=sb*sc*b*c;
      sol=`${formatCoeff(a2v2,true)}${v1}¬≤`;
      if(xCoeff>0)sol+=` + ${formatCoeff(xCoeff,true)}${v1}`;
      else if(xCoeff<0)sol+=` - ${formatCoeff(Math.abs(xCoeff),true)}${v1}`;
      if(bc>0)sol+=` + ${bc}`; else if(bc<0)sol+=` - ${Math.abs(bc)}`;
    } else {
      const a1a2=a1*a2,ab=a1*sc*c,ac=a2*sb*b,bc=sb*sc*b*c;
      sol=`${formatCoeff(a1a2,true)}${sortVars(v1,v2)}`;
      if(ab>0)sol+=` + ${formatCoeff(ab,true)}${v1}`;
      else if(ab<0)sol+=` - ${formatCoeff(Math.abs(ab),true)}${v1}`;
      if(ac>0)sol+=` + ${formatCoeff(ac,true)}${v2}`;
      else if(ac<0)sol+=` - ${formatCoeff(Math.abs(ac),true)}${v2}`;
      if(bc>0)sol+=` + ${bc}`; else if(bc<0)sol+=` - ${Math.abs(bc)}`;
    }
    correctSolution=sol;
    return `(${a1}${v1} ${s1} ${b}) ¬∑ (${a2}${v2} ${s2} ${c}) = ?`;
  }

  function createPlusMinusBinom(){
    const v=randomVar(),a=randomCoeff(),b=randomCoeff();
    correctSolution=`${formatCoeff(a*a,true)}${v}¬≤ - ${b*b}`;
    return `(${a}${v} + ${b}) ¬∑ (${a}${v} - ${b}) = ?`;
  }

    // --- Schlichte, einheitliche L√∂sungswege (nur schwarz, d√ºnn) ---
  const explanations = {
    1: {
      title: "Ganze Zahlen",
      steps: [
        "1. Vorzeichen bestimmen:",
        "   gleiche Vorzeichen ‚Üí +",
        "   verschiedene Vorzeichen ‚Üí ‚àí",
        "2. Zahlen multiplizieren"
      ],
      example: "(‚àí3) ¬∑ (‚àí2) = +6"
    },
    2: {
      title: "Monome",
      steps: [
        "1. Vorzeichen bestimmen:",
        "   gleiche Vorzeichen ‚Üí +",
        "   verschiedene Vorzeichen ‚Üí ‚àí",
        "2. Zahlen multiplizieren und Variablen anh√§ngen (x¬∑x = x¬≤)"
      ],
      example: "(‚àí3x) ¬∑ (2x) = ‚àí6x¬≤"
    },
    3: {
      title: "Monom ¬∑ Binom",
      steps: [
        "1. Vorzeichen beachten:",
        "   gleiche ‚Üí +",
        "   verschiedene ‚Üí ‚àí",
        "2. Monom mit jedem Glied der Klammer multiplizieren"
      ],
      example: "3x ¬∑ (x + 2) = 3x¬≤ + 6x"
    },
    4: {
      title: "Binom ¬∑ Binom",
      steps: [
        "1. Vorzeichen beachten:",
        "   gleiche ‚Üí +",
        "   verschiedene ‚Üí ‚àí",
        "2. Jeden Term der ersten Klammer mit jedem der zweiten multiplizieren"
      ],
      example: "(x + 2)(x + 3) = x¬≤ + 5x + 6"
    },
    5: {
      title: "Gemischte Aufgaben",
      steps: [
        "1. Erkennen, welche Regel passt:",
        "   gleiche ‚Üí +",
        "   verschiedene ‚Üí ‚àí",
        "2. Passendes Verfahren anwenden"
      ],
      example: "(2x + 1)(x ‚àí 4) = 2x¬≤ ‚àí 7x ‚àí 4"
    }
  };

  // --- Anzeige der L√∂sung & Fortschritt ---
  function checkAnswer(){
    const input = answerEl.value.trim();
    if (!input) {
      resultEl.style.color = "#444";
      resultEl.innerText = "Bitte gib eine L√∂sung ein.";
      return;
    }
    answerEl.blur();

    if (normMul(input) === normMul(correctSolution)) {
      resultEl.style.color = "green";
      if (firstTry) {
        resultEl.innerText = "‚úÖ Richtig! (+1 Punkt)";
        score++;
      } else {
        resultEl.innerText = "‚úÖ Richtig ‚Äì aber kein Punkt mehr (zweiter Versuch)";
      }
      firstTry = false;
      round++;
      updateProgress();
      scoreEl.innerText = `Aufgabe ${Math.min(round, totalRounds)} von ${totalRounds} ‚Äì Punkte: ${score}`;
    } else {
      const exp = explanations[level];
      resultEl.style.color = "#000";
      let html = `<span style="color:#d00;">‚ùå Falsch!</span> Richtige L√∂sung: <b>${correctSolution}</b><br>`;
      if (exp) {
        html += `
        <details open>
          <summary style="color:#007bff;cursor:pointer;font-weight:500;">üß© L√∂sungsweg anzeigen</summary>
          <div style="text-align:left;max-width:420px;margin:6px auto;font-size:0.95em;line-height:1.4;color:#000;font-weight:400;">
            <div style="margin-bottom:4px;font-weight:500;">${exp.title}</div>
            ${exp.steps.map(s => `<div>${s}</div>`).join("")}
            <div style="margin-top:6px;font-style:italic;">Beispiel: ${exp.example}</div>
          </div>
        </details>`;
      }
      resultEl.innerHTML = html;
      firstTry = false;
    }
  }


  // --- Eventhandler ---
  checkBtn.addEventListener("click", checkAnswer);
  newBtn.addEventListener("click", newTask);
  answerEl.addEventListener("keydown", e => { if (e.key === "Enter") checkAnswer(); });

  newTask();


});
</script>
</body>
</html>
